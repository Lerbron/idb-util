function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(o=r.key,a=void 0,"symbol"==typeof(a=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o,"string"))?a:String(a)),r)}var o,a}var t=function(){function t(e){var n=e.dbName,r=e.stores,o=void 0===r?[]:r,a=e.version,s=void 0===a?1:a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.dbName=n,this.version=s,this.stores=o,this.db=null,this.init()}var n,r,o;return n=t,r=[{key:"init",value:function(){var e=this,t=window.indexedDB.open(this.dbName,this.version);t.onerror=function(e){},t.onsuccess=function(n){e.db=t.result},t.onupgradeneeded=function(t){var n=t.target.result;e.initStores(n,e)}}},{key:"initStores",value:function(e,t){t.stores.forEach((function(t){if(!e.objectStoreNames.contains(t.name)){var n=t.keyPath?{keyPath:t.keyPath}:{},r=e.createObjectStore(t.name,n),o=t.indexes;if(o instanceof Array&&o.length>0)for(var a=0;a<o.length;a++){var s=o[a],i=s.indexName,u=s.keyPath,c=s.objectParameters,l=void 0===c?{}:c;i&&u&&r.createIndex(i,u,l)}}}))}},{key:"addData",value:function(e,t){var n=this;return new Promise((function(r,o){var a=n.db.transaction(e,"readwrite").objectStore(e);a.add(t),a.onsuccess=function(e){r&&r({status:"success"})},a.onerror=function(e){o&&o({status:"fail"})}}))}},{key:"getDataByKey",value:function(e,t){var n=this;return new Promise((function(r,o){var a=n.db.transaction([e]).objectStore(e).get(t);a.onerror=function(e){o&&o("err")},a.onsuccess=function(e){a.result?r&&r(a.result):r&&r(null)}}))}},{key:"getDataByIndex",value:function(e,t,n){var r=this;return new Promise((function(o,a){var s=r.db.transaction(e,"readonly").objectStore(e).index(t).get(n);s.onerror=function(){a&&a({status:"fail",msg:"获取失败"})},s.onsuccess=function(e){var t=e.target.result;o&&o(t)}}))}},{key:"getDataByIndexAndPage",value:function(e,t,n){var r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30;return new Promise((function(s,i){var u=[],c=0,l=!0,f=r.db.transaction(e,"readonly").objectStore(e).index(t),v=f.count(IDBKeyRange.only(n)),d=f.openCursor(IDBKeyRange.only(n));d.onerror=function(){i&&i({status:"fail",msg:"获取失败"})},d.onsuccess=function(e){var t=e.target.result;if(o>1&&l)return l=!1,void t.advance((o-1)*a);t?(u.push(t.value),++c<a?t.continue():(t=null,s&&s({total:v.result,list:u}))):s&&s({total:v.result||0,list:u})}}))}},{key:"getDataByPage",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:30;return new Promise((function(o,a){var s=[],i=0,u=!0,c=t.db.transaction(e,"readonly").objectStore(e),l=c.openCursor(),f=c.count();l.onsuccess=function(e){var t=e.target.result;if(n>1&&u)return u=!1,void t.advance((n-1)*r);t?(s.push(t.value),++i<r?t.continue():(t=null,o&&o({total:f.result,list:s}))):o&&o({total:f.result||0,list:s})},l.onerror=function(e){a&&a(e)}}))}},{key:"readAllData",value:function(e){var t=this;return new Promise((function(n,r){var o=t.db.transaction(e).objectStore(e),a=[];o.openCursor().onsuccess=function(e){var t=e.target.result;t?(a.push(t.value),t.continue()):n&&n(a)}}))}},{key:"updateData",value:function(e,t){var n=this;return new Promise((function(r,o){var a=n.db.transaction([e],"readwrite").objectStore(e);a.put(t),a.onsuccess=function(e){r&&r({status:"success"})},a.onerror=function(e){o&&o({status:"fail"})}}))}},{key:"deleteData",value:function(e,t){var n=this;return new Promise((function(r,o){var a=n.db.transaction([e],"readwrite").objectStore(e).delete(t);a.onsuccess=function(e){r&&r({status:"success"})},a.onerror=function(e){o&&o({status:"fail",data:e})}}))}},{key:"deleteDataByIndex",value:function(e,t,n){var r=this;return new Promise((function(o,a){var s=r.db.transaction(e,"readwrite").objectStore(e).index(t).openCursor(IDBKeyRange.only(n));s.onsuccess=function(e){var t,n=e.target.result;n&&((t=n.delete()).onerror=function(){a&&a({status:"fail",msg:"游标删除该记录失败"})},t.onsuccess=function(){o&&o({status:"success",msg:"游标删除该记录成功"})},n.continue())},s.onerror=function(e){a&&a({status:"fail",msg:"deleteRequest 失败"})}}))}},{key:"clearStore",value:function(e){var t=this;return new Promise((function(n,r){var o=t.db.transaction([e],"readwrite").objectStore(e).clear();o.onsuccess=function(e){n&&n({status:"success"})},o.onerror=function(e){r&&r({status:"fail"})}}))}},{key:"clearAllStore",value:function(){var e=this;return new Promise((function(t,n){var r=[];e.stores.map((function(t){var n=t.name;r.push(e.clearStore(n))})),Promise.all(r).then((function(e){t&&t({status:"success"})})).catch((function(e){n&&n(e)}))}))}},{key:"deleteDatabase",value:function(){var e=this;return new Promise((function(t,n){var r=window.indexedDB.deleteDatabase(e.dbName);r.onerror=function(e){n&&n(e)},r.onsuccess=function(e){t&&t({status:"success"})}}))}}],r&&e(n.prototype,r),o&&e(n,o),Object.defineProperty(n,"prototype",{writable:!1}),t}();export{t as default};
